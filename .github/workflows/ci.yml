name: UI Python Playwright

on:
  push:
    branches:
      [master]
  pull_request:

jobs:
  tests:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        browser: [chromium, firefox]
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          playwright install --with-deps
      - name: Run tests with allure files generation
        run: pytest --browser=${{ matrix.browser }} --alluredir=reports/allure-reports
      - name: Install Allure
        run: |
          curl -L -o allure-commandline.tgz https://github.com/allure-framework/allure2/releases/download/2.29/allure-commandline-2.29.tgz
          sudo tar -zxvf allure-commandline.tgz -C /opt/
          sudo ln -s /opt/allure-2.29.0/bin/allure /usr/bin/allure
      - name: Generate Allure report
        run: allure generate reports/allure-reports -o reports/allure-report --clean
      - name: Deploy Allure report to GH Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: reports/allure-report
          publish_branch: gh-pages